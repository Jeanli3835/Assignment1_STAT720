<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Assignment 3</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="Assignment3_STAT720_files/libs/clipboard/clipboard.min.js"></script>
<script src="Assignment3_STAT720_files/libs/quarto-html/quarto.js"></script>
<script src="Assignment3_STAT720_files/libs/quarto-html/popper.min.js"></script>
<script src="Assignment3_STAT720_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="Assignment3_STAT720_files/libs/quarto-html/anchor.min.js"></script>
<link href="Assignment3_STAT720_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="Assignment3_STAT720_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="Assignment3_STAT720_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="Assignment3_STAT720_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="Assignment3_STAT720_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">


</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Assignment 3</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(Matrix)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(mlmRev)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: lme4</code></pre>
</div>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(nlme)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'nlme'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:mlmRev':

    bdf, Oxboys</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:lme4':

    lmList</code></pre>
</div>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lme4)</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lmerTest)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'lmerTest'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:lme4':

    lmer</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:stats':

    step</code></pre>
</div>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(performance)</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(DHARMa)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>This is DHARMa 0.4.6. For overview type '?DHARMa'. For recent changes, type news(package = 'DHARMa')</code></pre>
</div>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(merTools)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: arm</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: MASS</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>
arm (Version 1.14-4, built: 2024-4-1)</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Working directory is C:/Users/Linai/OneDrive/Desktop</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'arm'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:performance':

    display</code></pre>
</div>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(glmmTMB)</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(purrr)</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(broom.mixed)</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(pbkrtest)</span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(patchwork)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'patchwork'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:MASS':

    area</code></pre>
</div>
</div>
<p>Input the data from the package and transform the data to the specific way and scale the numeric predictor.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>data<span class="ot">&lt;-</span>mlmRev<span class="sc">::</span>ScotsSec</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a><span class="fu">View</span>(data)</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>data<span class="sc">$</span>social<span class="ot">&lt;-</span><span class="fu">as.factor</span>(data<span class="sc">$</span>social)</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>data<span class="sc">$</span>primary<span class="ot">&lt;-</span><span class="fu">as.factor</span>(data<span class="sc">$</span>primary)</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>data<span class="sc">$</span>sex<span class="ot">&lt;-</span><span class="fu">as.factor</span>(data<span class="sc">$</span>sex)</span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>data<span class="sc">$</span>verbal_scale<span class="ot">&lt;-</span><span class="fu">scale</span>(data<span class="sc">$</span>verbal)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="a" class="level2">
<h2 class="anchored" data-anchor-id="a">a</h2>
<p>setting attain as the response variable and social, sex, verbal as the fixed effects, in addition with the random effect with the primary as group variable(random slope effect).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>model_1<span class="ot">&lt;-</span>lmerTest<span class="sc">::</span><span class="fu">lmer</span>(attain<span class="sc">~</span>verbal_scale<span class="sc">+</span>sex<span class="sc">+</span>social<span class="sc">+</span>(verbal_scale<span class="sc">+</span>sex<span class="sc">+</span>social<span class="sc">|</span>primary),data,<span class="at">REML =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="b." class="level2">
<h2 class="anchored" data-anchor-id="b.">b.</h2>
<p>We have to check whether the model is sigular fit(too complex random effects overfitted)</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>lme4<span class="sc">::</span><span class="fu">isSingular</span>(model_1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] FALSE</code></pre>
</div>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>performance<span class="sc">::</span><span class="fu">check_singularity</span>(model_1) <span class="do">## why the result is different?</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] FALSE</code></pre>
</div>
</div>
<p>And then the model is sigular fitted, fixed by method 1 and method 2</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Method1</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a><span class="co"># we use the summary() to find the smallest variance of the random effect estimators is verbal_scale, 0.0210</span></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a><span class="co"># or by VarCorr()</span></span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>varcor_radomeffecr<span class="ot">&lt;-</span>lme4<span class="sc">::</span><span class="fu">VarCorr</span>(model_1)</span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>pca<span class="ot">&lt;-</span>lme4<span class="sc">::</span><span class="fu">rePCA</span>(model_1)</span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a><span class="co"># the variable corresponding to the largest absolute value in the last columne of the eigenvector matrix is the verbal_scale, same as method 1</span></span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a>model_2<span class="ot">&lt;-</span>lmerTest<span class="sc">::</span><span class="fu">lmer</span>(attain<span class="sc">~</span>verbal_scale<span class="sc">+</span>sex<span class="sc">+</span>social<span class="sc">+</span>(sex<span class="sc">+</span>social<span class="sc">|</span>primary),data,<span class="at">REML =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>boundary (singular) fit: see help('isSingular')</code></pre>
</div>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="co"># as the warnings, need to change the formate too simple</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>model_2new<span class="ot">&lt;-</span>lmerTest<span class="sc">::</span><span class="fu">lmer</span>(attain<span class="sc">~</span>verbal_scale<span class="sc">+</span>sex<span class="sc">+</span>social<span class="sc">+</span>(<span class="dv">0</span><span class="sc">+</span>sex<span class="sc">+</span>social<span class="sc">|</span>primary)<span class="sc">+</span>(<span class="dv">1</span><span class="sc">|</span>primary),data,<span class="at">REML =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>boundary (singular) fit: see help('isSingular')</code></pre>
</div>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="fu">isSingular</span>(model_2new)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] TRUE</code></pre>
</div>
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>lme4<span class="sc">::</span><span class="fu">VarCorr</span>(model_2new)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> Groups    Name        Std.Dev. Corr                       
 primary   sexM        0.00000                             
           sexF        0.38298     NaN                     
           social1     0.08469     NaN -0.997              
           social20    0.37815     NaN -0.585  0.610       
           social31    0.53785     NaN -0.727  0.703 -0.131
 primary.1 (Intercept) 0.36898                             
 Residual              2.00307                             </code></pre>
</div>
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>lme4<span class="sc">::</span><span class="fu">rePCA</span>(model_2new)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$primary
Standard deviations (1, .., p=6):
[1] 3.125217e-01 2.200096e-01 1.842068e-01 2.850124e-03 1.345306e-04
[6] 3.228573e-18

Rotation (n x k) = (6 x 6):
              [,1]          [,2] [,3]          [,4]          [,5]          [,6]
[1,] -1.110223e-16  5.551115e-17    0 -1.973465e-15 -4.179579e-15  1.000000e+00
[2,] -5.532531e-01 -3.709567e-01    0  3.075108e-02 -7.452224e-01 -2.997602e-15
[3,]  1.201184e-01  8.750852e-02    0 -9.736605e-01 -1.729133e-01 -2.636780e-15
[4,]  1.105722e-01  8.435755e-01    0  1.773100e-01 -4.946871e-01 -1.776357e-15
[5,]  8.168576e-01 -3.783038e-01    0  1.400025e-01 -4.123460e-01 -1.332268e-15
[6,]  0.000000e+00  0.000000e+00    1  0.000000e+00  0.000000e+00  0.000000e+00

attr(,"class")
[1] "prcomplist"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Then discard the "social" random effect variable.</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>model_3<span class="ot">&lt;-</span>lmerTest<span class="sc">::</span><span class="fu">lmer</span>(attain<span class="sc">~</span>verbal_scale<span class="sc">+</span>sex<span class="sc">+</span>social<span class="sc">+</span>(sex<span class="sc">|</span>primary),data,<span class="at">REML =</span> <span class="cn">TRUE</span>)</span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>lme4<span class="sc">::</span><span class="fu">isSingular</span>(model_3)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] FALSE</code></pre>
</div>
</div>
</section>
<section id="c." class="level2">
<h2 class="anchored" data-anchor-id="c.">c.</h2>
<p>Diagnostics on the fitted model”model_3”</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>performance<span class="sc">::</span><span class="fu">check_model</span>(model_3)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Some of the variables were in matrix-format - probably you used
  `scale()` on your data?
  If so, and you get an error, please try `datawizard::standardize()` to
  standardize your data.
Some of the variables were in matrix-format - probably you used
  `scale()` on your data?
  If so, and you get an error, please try `datawizard::standardize()` to
  standardize your data.</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Assignment3_STAT720_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>sim_output<span class="ot">&lt;-</span>DHARMa<span class="sc">::</span><span class="fu">simulateResiduals</span>(model_3)</span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(sim_output)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Assignment3_STAT720_files/figure-html/unnamed-chunk-6-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>performance<span class="sc">::</span><span class="fu">check_model</span>(<span class="fu">lm</span>(attain<span class="sc">~</span>verbal_scale<span class="sc">+</span>sex<span class="sc">+</span>social,data))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Some of the variables were in matrix-format - probably you used
  `scale()` on your data?
  If so, and you get an error, please try `datawizard::standardize()` to
  standardize your data.
Some of the variables were in matrix-format - probably you used
  `scale()` on your data?
  If so, and you get an error, please try `datawizard::standardize()` to
  standardize your data.</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Assignment3_STAT720_files/figure-html/unnamed-chunk-6-3.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>In conclusion, based on the diagnostic plots, the model closely aligns with the assumptions of the linear mixed model. This includes the conditional distribution for the dependent variable (y) and the random effects, which are assumed to follow a normal distribution. There are no influential points, and homogeneity of variance is observed. The fitted effects of the predictors show no signs of multicollinearity. However, it is important to note that there may be greater prediction errors.</p>
<p>To compare the diagnostics, we can analyze the plots of the fitted effects from both the linear model and the linear mixed model (which includes random effects). Additionally, we should include a plot that assesses the assumption of the random effects parameter, referred to as “Normality of Random Effects.”</p>
</section>
<section id="d." class="level2">
<h2 class="anchored" data-anchor-id="d.">d.</h2>
<p>fit the mixed model by other packages.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>model_nlm<span class="ot">&lt;-</span>nlme<span class="sc">::</span><span class="fu">lme</span>(attain<span class="sc">~</span>verbal_scale<span class="sc">+</span>sex<span class="sc">+</span>social, <span class="at">random=</span> <span class="sc">~</span> sex<span class="sc">|</span>primary,data,<span class="at">method =</span> <span class="st">"REML"</span>)</span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>model_glmmTMB <span class="ot">&lt;-</span> glmmTMB<span class="sc">::</span><span class="fu">glmmTMB</span>(attain <span class="sc">~</span> verbal_scale<span class="sc">+</span>sex<span class="sc">+</span>social<span class="sc">+</span>(sex <span class="sc">|</span> primary),<span class="at">data=</span> data,<span class="at">REML =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="e." class="level2">
<h2 class="anchored" data-anchor-id="e.">e.</h2>
<p>Compare the different packages</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>models<span class="ot">&lt;-</span><span class="fu">list</span>(<span class="st">"lmer"</span><span class="ot">=</span>model_3,<span class="st">"lme"</span><span class="ot">=</span>model_nlm,<span class="st">"glmmTMB"</span><span class="ot">=</span>model_glmmTMB)</span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a>purrr<span class="sc">::</span><span class="fu">map_dfr</span>(models,broom.mixed<span class="sc">::</span>glance,<span class="at">.id=</span><span class="st">"model"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 9
  model    nobs sigma logLik    AIC    BIC REMLcrit df.residual deviance
  &lt;chr&gt;   &lt;int&gt; &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;    &lt;dbl&gt;       &lt;int&gt;    &lt;dbl&gt;
1 lmer     3435  2.01 -7338. 14695. 14757.   14675.        3425      NA 
2 lme      3435  2.01 -7338. 14695. 14757.      NA           NA      NA 
3 glmmTMB  3435  2.01 -7338. 14695. 14757.      NA         3425   13445.</code></pre>
</div>
</div>
<p>It’s the same result.</p>
</section>
<section id="f." class="level2">
<h2 class="anchored" data-anchor-id="f.">f.</h2>
<p>Compare the different packages coefficients</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>coefficients_dataframe<span class="ot">&lt;-</span>purrr<span class="sc">::</span><span class="fu">map_dfr</span>(models,<span class="sc">~</span>broom.mixed<span class="sc">::</span><span class="fu">tidy</span>(., <span class="at">effects =</span> <span class="st">"fixed"</span>), <span class="at">.id =</span> <span class="st">"model"</span>) <span class="sc">|&gt;</span> dplyr<span class="sc">::</span><span class="fu">arrange</span>(term)</span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Compare the Intercept term</span></span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a>Intercept<span class="ot">&lt;-</span>coefficients_dataframe<span class="sc">|&gt;</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(term<span class="sc">==</span><span class="st">"(Intercept)"</span>)<span class="sc">|&gt;</span> dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="st">"model"</span>,<span class="st">"effect"</span>,<span class="st">"term"</span>,<span class="st">"estimate"</span>,<span class="st">"std.error"</span>, <span class="st">"df"</span>,<span class="st">"p.value"</span>)</span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a>lmerlme_est<span class="ot">&lt;-</span><span class="fu">all.equal</span>(Intercept[<span class="dv">1</span>,<span class="dv">4</span>],Intercept[<span class="dv">2</span>,<span class="dv">4</span>],<span class="at">tolerance=</span><span class="dv">10</span><span class="sc">^-</span><span class="dv">4</span>)</span>
<span id="cb49-6"><a href="#cb49-6" aria-hidden="true" tabindex="-1"></a>lmerlme_sd<span class="ot">&lt;-</span><span class="fu">all.equal</span>(Intercept[<span class="dv">1</span>,<span class="dv">5</span>],Intercept[<span class="dv">2</span>,<span class="dv">5</span>],<span class="at">tolerance=</span><span class="dv">10</span><span class="sc">^-</span><span class="dv">4</span>)</span>
<span id="cb49-7"><a href="#cb49-7" aria-hidden="true" tabindex="-1"></a>lmerlme_df<span class="ot">&lt;-</span><span class="fu">all.equal</span>(Intercept[<span class="dv">1</span>,<span class="dv">6</span>],Intercept[<span class="dv">2</span>,<span class="dv">6</span>])</span>
<span id="cb49-8"><a href="#cb49-8" aria-hidden="true" tabindex="-1"></a>lmerlme_pvalue<span class="ot">&lt;-</span><span class="fu">all.equal</span>(Intercept[<span class="dv">1</span>,<span class="dv">7</span>],Intercept[<span class="dv">2</span>,<span class="dv">7</span>],<span class="at">tolerance=</span><span class="dv">10</span><span class="sc">^-</span><span class="dv">4</span>)</span>
<span id="cb49-9"><a href="#cb49-9" aria-hidden="true" tabindex="-1"></a>lmerglmmTMB_est<span class="ot">&lt;-</span><span class="fu">all.equal</span>(Intercept[<span class="dv">1</span>,<span class="dv">4</span>],Intercept[<span class="dv">3</span>,<span class="dv">4</span>],<span class="at">tolerance=</span><span class="dv">10</span><span class="sc">^-</span><span class="dv">4</span>)</span>
<span id="cb49-10"><a href="#cb49-10" aria-hidden="true" tabindex="-1"></a>lmerglmmTMB_sd<span class="ot">&lt;-</span><span class="fu">all.equal</span>(Intercept[<span class="dv">1</span>,<span class="dv">5</span>],Intercept[<span class="dv">3</span>,<span class="dv">5</span>],<span class="at">tolerance=</span><span class="fl">0.01</span>)</span>
<span id="cb49-11"><a href="#cb49-11" aria-hidden="true" tabindex="-1"></a>lmerglmmTMB_df<span class="ot">&lt;-</span><span class="fu">all.equal</span>(Intercept[<span class="dv">1</span>,<span class="dv">6</span>],Intercept[<span class="dv">3</span>,<span class="dv">6</span>])</span>
<span id="cb49-12"><a href="#cb49-12" aria-hidden="true" tabindex="-1"></a>lmerglmmTMB_p<span class="ot">&lt;-</span><span class="fu">all.equal</span>(Intercept[<span class="dv">1</span>,<span class="dv">7</span>],Intercept[<span class="dv">3</span>,<span class="dv">7</span>],<span class="at">tolerance=</span><span class="dv">10</span><span class="sc">^-</span><span class="dv">4</span>)</span>
<span id="cb49-13"><a href="#cb49-13" aria-hidden="true" tabindex="-1"></a>lmeglmmTMB_est<span class="ot">&lt;-</span><span class="fu">all.equal</span>(Intercept[<span class="dv">2</span>,<span class="dv">4</span>],Intercept[<span class="dv">3</span>,<span class="dv">4</span>],<span class="at">tolerance=</span><span class="dv">10</span><span class="sc">^-</span><span class="dv">4</span>)</span>
<span id="cb49-14"><a href="#cb49-14" aria-hidden="true" tabindex="-1"></a>lmeglmmTMB_sd<span class="ot">&lt;-</span><span class="fu">all.equal</span>(Intercept[<span class="dv">2</span>,<span class="dv">5</span>],Intercept[<span class="dv">3</span>,<span class="dv">5</span>],<span class="at">tolerance=</span><span class="fl">0.01</span>)</span>
<span id="cb49-15"><a href="#cb49-15" aria-hidden="true" tabindex="-1"></a>lmeglmmTMB_df<span class="ot">&lt;-</span><span class="fu">all.equal</span>(Intercept[<span class="dv">2</span>,<span class="dv">6</span>],Intercept[<span class="dv">3</span>,<span class="dv">6</span>],<span class="at">tolerance=</span><span class="dv">1</span>)</span>
<span id="cb49-16"><a href="#cb49-16" aria-hidden="true" tabindex="-1"></a>lmeglmmTMB_pvalue<span class="ot">&lt;-</span><span class="fu">all.equal</span>(Intercept[<span class="dv">2</span>,<span class="dv">7</span>],Intercept[<span class="dv">3</span>,<span class="dv">7</span>],<span class="at">tolerance=</span><span class="dv">10</span><span class="sc">^-</span><span class="dv">4</span>)</span>
<span id="cb49-17"><a href="#cb49-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-18"><a href="#cb49-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Compare the sexF term</span></span>
<span id="cb49-19"><a href="#cb49-19" aria-hidden="true" tabindex="-1"></a>sexF<span class="ot">&lt;-</span>coefficients_dataframe<span class="sc">|&gt;</span>dplyr<span class="sc">::</span><span class="fu">filter</span>(term<span class="sc">==</span><span class="st">"sexF"</span>)<span class="sc">|&gt;</span>dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="st">"model"</span>,<span class="st">"effect"</span>,<span class="st">"term"</span>,<span class="st">"estimate"</span>,<span class="st">"std.error"</span>, <span class="st">"df"</span>,<span class="st">"p.value"</span>)</span>
<span id="cb49-20"><a href="#cb49-20" aria-hidden="true" tabindex="-1"></a>lmerlme_est<span class="ot">&lt;-</span><span class="fu">all.equal</span>(sexF[<span class="dv">1</span>,<span class="dv">4</span>],sexF[<span class="dv">2</span>,<span class="dv">4</span>],<span class="at">tolerance=</span><span class="dv">10</span><span class="sc">^-</span><span class="dv">4</span>)</span>
<span id="cb49-21"><a href="#cb49-21" aria-hidden="true" tabindex="-1"></a>lmerlme_sd<span class="ot">&lt;-</span><span class="fu">all.equal</span>(sexF[<span class="dv">1</span>,<span class="dv">5</span>],sexF[<span class="dv">2</span>,<span class="dv">5</span>],<span class="at">tolerance=</span><span class="dv">10</span><span class="sc">^-</span><span class="dv">4</span>)</span>
<span id="cb49-22"><a href="#cb49-22" aria-hidden="true" tabindex="-1"></a>lmerlme_df<span class="ot">&lt;-</span><span class="fu">all.equal</span>(sexF[<span class="dv">1</span>,<span class="dv">6</span>],sexF[<span class="dv">2</span>,<span class="dv">6</span>])</span>
<span id="cb49-23"><a href="#cb49-23" aria-hidden="true" tabindex="-1"></a>lmerlme_pvalue<span class="ot">&lt;-</span><span class="fu">all.equal</span>(sexF[<span class="dv">1</span>,<span class="dv">7</span>],sexF[<span class="dv">2</span>,<span class="dv">7</span>],<span class="at">tolerance=</span><span class="fl">0.1</span>)</span>
<span id="cb49-24"><a href="#cb49-24" aria-hidden="true" tabindex="-1"></a>lmerglmmTMB_est<span class="ot">&lt;-</span><span class="fu">all.equal</span>(sexF[<span class="dv">1</span>,<span class="dv">4</span>],sexF[<span class="dv">3</span>,<span class="dv">4</span>],<span class="at">tolerance=</span><span class="dv">10</span><span class="sc">^-</span><span class="dv">4</span>)</span>
<span id="cb49-25"><a href="#cb49-25" aria-hidden="true" tabindex="-1"></a>lmerglmmTMB_sd<span class="ot">&lt;-</span><span class="fu">all.equal</span>(sexF[<span class="dv">1</span>,<span class="dv">5</span>],sexF[<span class="dv">3</span>,<span class="dv">5</span>],<span class="at">tolerance=</span><span class="fl">0.01</span>)</span>
<span id="cb49-26"><a href="#cb49-26" aria-hidden="true" tabindex="-1"></a>lmerglmmTMB_df<span class="ot">&lt;-</span><span class="fu">all.equal</span>(sexF[<span class="dv">1</span>,<span class="dv">6</span>],sexF[<span class="dv">3</span>,<span class="dv">6</span>])</span>
<span id="cb49-27"><a href="#cb49-27" aria-hidden="true" tabindex="-1"></a>lmerglmmTMB_p<span class="ot">&lt;-</span><span class="fu">all.equal</span>(sexF[<span class="dv">1</span>,<span class="dv">7</span>],sexF[<span class="dv">3</span>,<span class="dv">7</span>],<span class="at">tolerance=</span><span class="fl">0.1</span>)</span>
<span id="cb49-28"><a href="#cb49-28" aria-hidden="true" tabindex="-1"></a>lmeglmmTMB_est<span class="ot">&lt;-</span><span class="fu">all.equal</span>(sexF[<span class="dv">2</span>,<span class="dv">4</span>],sexF[<span class="dv">3</span>,<span class="dv">4</span>],<span class="at">tolerance=</span><span class="dv">10</span><span class="sc">^-</span><span class="dv">4</span>)</span>
<span id="cb49-29"><a href="#cb49-29" aria-hidden="true" tabindex="-1"></a>lmeglmmTMB_sd<span class="ot">&lt;-</span><span class="fu">all.equal</span>(sexF[<span class="dv">2</span>,<span class="dv">5</span>],sexF[<span class="dv">3</span>,<span class="dv">5</span>],<span class="at">tolerance=</span><span class="fl">0.01</span>)</span>
<span id="cb49-30"><a href="#cb49-30" aria-hidden="true" tabindex="-1"></a>lmeglmmTMB_df<span class="ot">&lt;-</span><span class="fu">all.equal</span>(sexF[<span class="dv">2</span>,<span class="dv">6</span>],sexF[<span class="dv">3</span>,<span class="dv">6</span>])</span>
<span id="cb49-31"><a href="#cb49-31" aria-hidden="true" tabindex="-1"></a>lmeglmmTMB_pvalue<span class="ot">&lt;-</span><span class="fu">all.equal</span>(sexF[<span class="dv">2</span>,<span class="dv">7</span>],sexF[<span class="dv">3</span>,<span class="dv">7</span>],<span class="at">tolerance=</span><span class="fl">0.1</span>)</span>
<span id="cb49-32"><a href="#cb49-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-33"><a href="#cb49-33" aria-hidden="true" tabindex="-1"></a><span class="co"># Compare the social1 term</span></span>
<span id="cb49-34"><a href="#cb49-34" aria-hidden="true" tabindex="-1"></a>social1<span class="ot">&lt;-</span>coefficients_dataframe<span class="sc">|&gt;</span>dplyr<span class="sc">::</span><span class="fu">filter</span>(term<span class="sc">==</span><span class="st">"social1"</span>)<span class="sc">|&gt;</span>dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="st">"model"</span>,<span class="st">"effect"</span>,<span class="st">"term"</span>,<span class="st">"estimate"</span>,<span class="st">"std.error"</span>, <span class="st">"df"</span>,<span class="st">"p.value"</span>)</span>
<span id="cb49-35"><a href="#cb49-35" aria-hidden="true" tabindex="-1"></a>lmerlme_est<span class="ot">&lt;-</span><span class="fu">all.equal</span>(social1[<span class="dv">1</span>,<span class="dv">4</span>],social1[<span class="dv">2</span>,<span class="dv">4</span>],<span class="at">tolerance=</span><span class="dv">10</span><span class="sc">^-</span><span class="dv">4</span>)</span>
<span id="cb49-36"><a href="#cb49-36" aria-hidden="true" tabindex="-1"></a>lmerlme_sd<span class="ot">&lt;-</span><span class="fu">all.equal</span>(social1[<span class="dv">1</span>,<span class="dv">5</span>],social1[<span class="dv">2</span>,<span class="dv">5</span>],<span class="at">tolerance=</span><span class="dv">10</span><span class="sc">^-</span><span class="dv">4</span>)</span>
<span id="cb49-37"><a href="#cb49-37" aria-hidden="true" tabindex="-1"></a>lmerlme_df<span class="ot">&lt;-</span><span class="fu">all.equal</span>(social1[<span class="dv">1</span>,<span class="dv">6</span>],social1[<span class="dv">2</span>,<span class="dv">6</span>])</span>
<span id="cb49-38"><a href="#cb49-38" aria-hidden="true" tabindex="-1"></a>lmerlme_pvalue<span class="ot">&lt;-</span><span class="fu">all.equal</span>(social1[<span class="dv">1</span>,<span class="dv">7</span>],social1[<span class="dv">2</span>,<span class="dv">7</span>],<span class="at">tolerance=</span><span class="dv">10</span><span class="sc">^-</span><span class="dv">4</span>)</span>
<span id="cb49-39"><a href="#cb49-39" aria-hidden="true" tabindex="-1"></a>lmerglmmTMB_est<span class="ot">&lt;-</span><span class="fu">all.equal</span>(social1[<span class="dv">1</span>,<span class="dv">4</span>],social1[<span class="dv">3</span>,<span class="dv">4</span>],<span class="at">tolerance=</span><span class="dv">10</span><span class="sc">^-</span><span class="dv">4</span>)</span>
<span id="cb49-40"><a href="#cb49-40" aria-hidden="true" tabindex="-1"></a>lmerglmmTMB_sd<span class="ot">&lt;-</span><span class="fu">all.equal</span>(social1[<span class="dv">1</span>,<span class="dv">5</span>],social1[<span class="dv">3</span>,<span class="dv">5</span>],<span class="at">tolerance=</span><span class="fl">0.1</span>)</span>
<span id="cb49-41"><a href="#cb49-41" aria-hidden="true" tabindex="-1"></a>lmerglmmTMB_df<span class="ot">&lt;-</span><span class="fu">all.equal</span>(social1[<span class="dv">1</span>,<span class="dv">6</span>],social1[<span class="dv">3</span>,<span class="dv">6</span>])</span>
<span id="cb49-42"><a href="#cb49-42" aria-hidden="true" tabindex="-1"></a>lmerglmmTMB_p<span class="ot">&lt;-</span><span class="fu">all.equal</span>(social1[<span class="dv">1</span>,<span class="dv">7</span>],social1[<span class="dv">3</span>,<span class="dv">7</span>],<span class="at">tolerance=</span><span class="dv">10</span><span class="sc">^-</span><span class="dv">4</span>)</span>
<span id="cb49-43"><a href="#cb49-43" aria-hidden="true" tabindex="-1"></a>lmeglmmTMB_est<span class="ot">&lt;-</span><span class="fu">all.equal</span>(social1[<span class="dv">2</span>,<span class="dv">4</span>],social1[<span class="dv">3</span>,<span class="dv">4</span>],<span class="at">tolerance=</span><span class="dv">10</span><span class="sc">^-</span><span class="dv">4</span>)</span>
<span id="cb49-44"><a href="#cb49-44" aria-hidden="true" tabindex="-1"></a>lmeglmmTMB_sd<span class="ot">&lt;-</span><span class="fu">all.equal</span>(social1[<span class="dv">2</span>,<span class="dv">5</span>],social1[<span class="dv">3</span>,<span class="dv">5</span>],<span class="at">tolerance=</span><span class="fl">0.1</span>)</span>
<span id="cb49-45"><a href="#cb49-45" aria-hidden="true" tabindex="-1"></a>lmeglmmTMB_df<span class="ot">&lt;-</span><span class="fu">all.equal</span>(social1[<span class="dv">2</span>,<span class="dv">6</span>],social1[<span class="dv">3</span>,<span class="dv">6</span>])</span>
<span id="cb49-46"><a href="#cb49-46" aria-hidden="true" tabindex="-1"></a>lmeglmmTMB_pvalue<span class="ot">&lt;-</span><span class="fu">all.equal</span>(social1[<span class="dv">2</span>,<span class="dv">7</span>],social1[<span class="dv">3</span>,<span class="dv">7</span>],<span class="at">tolerance=</span><span class="dv">10</span><span class="sc">^-</span><span class="dv">4</span>)</span>
<span id="cb49-47"><a href="#cb49-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-48"><a href="#cb49-48" aria-hidden="true" tabindex="-1"></a><span class="co"># compare the social20 term</span></span>
<span id="cb49-49"><a href="#cb49-49" aria-hidden="true" tabindex="-1"></a>social20<span class="ot">&lt;-</span>coefficients_dataframe<span class="sc">|&gt;</span>dplyr<span class="sc">::</span><span class="fu">filter</span>(term<span class="sc">==</span><span class="st">"social20"</span>)<span class="sc">|&gt;</span>dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="st">"model"</span>,<span class="st">"effect"</span>,<span class="st">"term"</span>,<span class="st">"estimate"</span>,<span class="st">"std.error"</span>, <span class="st">"df"</span>,<span class="st">"p.value"</span>)</span>
<span id="cb49-50"><a href="#cb49-50" aria-hidden="true" tabindex="-1"></a>lmerlme_est<span class="ot">&lt;-</span><span class="fu">all.equal</span>(social20[<span class="dv">1</span>,<span class="dv">4</span>],social20[<span class="dv">2</span>,<span class="dv">4</span>],<span class="at">tolerance=</span><span class="dv">10</span><span class="sc">^-</span><span class="dv">4</span>)</span>
<span id="cb49-51"><a href="#cb49-51" aria-hidden="true" tabindex="-1"></a>lmerlme_sd<span class="ot">&lt;-</span><span class="fu">all.equal</span>(social20[<span class="dv">1</span>,<span class="dv">5</span>],social20[<span class="dv">2</span>,<span class="dv">5</span>],<span class="at">tolerance=</span><span class="dv">10</span><span class="sc">^-</span><span class="dv">4</span>)</span>
<span id="cb49-52"><a href="#cb49-52" aria-hidden="true" tabindex="-1"></a>lmerlme_df<span class="ot">&lt;-</span><span class="fu">all.equal</span>(social20[<span class="dv">1</span>,<span class="dv">6</span>],social20[<span class="dv">2</span>,<span class="dv">6</span>],<span class="at">tolerance=</span><span class="fl">0.1</span>)</span>
<span id="cb49-53"><a href="#cb49-53" aria-hidden="true" tabindex="-1"></a>lmerlme_pvalue<span class="ot">&lt;-</span><span class="fu">all.equal</span>(social20[<span class="dv">1</span>,<span class="dv">7</span>],social20[<span class="dv">2</span>,<span class="dv">7</span>],<span class="at">tolerance=</span><span class="dv">10</span><span class="sc">^-</span><span class="dv">4</span>)</span>
<span id="cb49-54"><a href="#cb49-54" aria-hidden="true" tabindex="-1"></a>lmerglmmTMB_est<span class="ot">&lt;-</span><span class="fu">all.equal</span>(social20[<span class="dv">1</span>,<span class="dv">4</span>],social20[<span class="dv">3</span>,<span class="dv">4</span>],<span class="at">tolerance=</span><span class="dv">10</span><span class="sc">^-</span><span class="dv">4</span>)</span>
<span id="cb49-55"><a href="#cb49-55" aria-hidden="true" tabindex="-1"></a>lmerglmmTMB_sd<span class="ot">&lt;-</span><span class="fu">all.equal</span>(social20[<span class="dv">1</span>,<span class="dv">5</span>],social20[<span class="dv">3</span>,<span class="dv">5</span>],<span class="at">tolerance=</span><span class="fl">0.1</span>)</span>
<span id="cb49-56"><a href="#cb49-56" aria-hidden="true" tabindex="-1"></a>lmerglmmTMB_df<span class="ot">&lt;-</span><span class="fu">all.equal</span>(social20[<span class="dv">1</span>,<span class="dv">6</span>],social20[<span class="dv">3</span>,<span class="dv">6</span>])</span>
<span id="cb49-57"><a href="#cb49-57" aria-hidden="true" tabindex="-1"></a>lmerglmmTMB_p<span class="ot">&lt;-</span><span class="fu">all.equal</span>(social20[<span class="dv">1</span>,<span class="dv">7</span>],social20[<span class="dv">3</span>,<span class="dv">7</span>],<span class="at">tolerance=</span><span class="dv">10</span><span class="sc">^-</span><span class="dv">4</span>)</span>
<span id="cb49-58"><a href="#cb49-58" aria-hidden="true" tabindex="-1"></a>lmeglmmTMB_est<span class="ot">&lt;-</span><span class="fu">all.equal</span>(social20[<span class="dv">2</span>,<span class="dv">4</span>],social20[<span class="dv">3</span>,<span class="dv">4</span>],<span class="at">tolerance=</span><span class="dv">10</span><span class="sc">^-</span><span class="dv">4</span>)</span>
<span id="cb49-59"><a href="#cb49-59" aria-hidden="true" tabindex="-1"></a>lmeglmmTMB_sd<span class="ot">&lt;-</span><span class="fu">all.equal</span>(social20[<span class="dv">2</span>,<span class="dv">5</span>],social20[<span class="dv">3</span>,<span class="dv">5</span>],<span class="at">tolerance=</span><span class="fl">0.1</span>)</span>
<span id="cb49-60"><a href="#cb49-60" aria-hidden="true" tabindex="-1"></a>lmeglmmTMB_df<span class="ot">&lt;-</span><span class="fu">all.equal</span>(social20[<span class="dv">2</span>,<span class="dv">6</span>],social20[<span class="dv">3</span>,<span class="dv">6</span>])</span>
<span id="cb49-61"><a href="#cb49-61" aria-hidden="true" tabindex="-1"></a>lmeglmmTMB_pvalue<span class="ot">&lt;-</span><span class="fu">all.equal</span>(social20[<span class="dv">2</span>,<span class="dv">7</span>],social20[<span class="dv">3</span>,<span class="dv">7</span>],<span class="at">tolerance=</span><span class="dv">10</span><span class="sc">^-</span><span class="dv">4</span>)</span>
<span id="cb49-62"><a href="#cb49-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-63"><a href="#cb49-63" aria-hidden="true" tabindex="-1"></a><span class="co"># compare the social31 term</span></span>
<span id="cb49-64"><a href="#cb49-64" aria-hidden="true" tabindex="-1"></a>social31<span class="ot">&lt;-</span>coefficients_dataframe<span class="sc">|&gt;</span>dplyr<span class="sc">::</span><span class="fu">filter</span>(term<span class="sc">==</span><span class="st">"social31"</span>)<span class="sc">|&gt;</span>dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="st">"model"</span>,<span class="st">"effect"</span>,<span class="st">"term"</span>,<span class="st">"estimate"</span>,<span class="st">"std.error"</span>, <span class="st">"df"</span>,<span class="st">"p.value"</span>)</span>
<span id="cb49-65"><a href="#cb49-65" aria-hidden="true" tabindex="-1"></a>lmerlme_est<span class="ot">&lt;-</span><span class="fu">all.equal</span>(social31[<span class="dv">1</span>,<span class="dv">4</span>],social31[<span class="dv">2</span>,<span class="dv">4</span>],<span class="at">tolerance=</span><span class="dv">10</span><span class="sc">^-</span><span class="dv">4</span>)</span>
<span id="cb49-66"><a href="#cb49-66" aria-hidden="true" tabindex="-1"></a>lmerlme_sd<span class="ot">&lt;-</span><span class="fu">all.equal</span>(social31[<span class="dv">1</span>,<span class="dv">5</span>],social31[<span class="dv">2</span>,<span class="dv">5</span>],<span class="at">tolerance=</span><span class="dv">10</span><span class="sc">^-</span><span class="dv">4</span>)</span>
<span id="cb49-67"><a href="#cb49-67" aria-hidden="true" tabindex="-1"></a>lmerlme_df<span class="ot">&lt;-</span><span class="fu">all.equal</span>(social31[<span class="dv">1</span>,<span class="dv">6</span>],social31[<span class="dv">2</span>,<span class="dv">6</span>],<span class="at">tolerance=</span><span class="fl">0.1</span>)</span>
<span id="cb49-68"><a href="#cb49-68" aria-hidden="true" tabindex="-1"></a>lmerlme_pvalue<span class="ot">&lt;-</span><span class="fu">all.equal</span>(social31[<span class="dv">1</span>,<span class="dv">7</span>],social31[<span class="dv">2</span>,<span class="dv">7</span>],<span class="at">tolerance=</span><span class="dv">10</span><span class="sc">^-</span><span class="dv">4</span>)</span>
<span id="cb49-69"><a href="#cb49-69" aria-hidden="true" tabindex="-1"></a>lmerglmmTMB_est<span class="ot">&lt;-</span><span class="fu">all.equal</span>(social31[<span class="dv">1</span>,<span class="dv">4</span>],social31[<span class="dv">3</span>,<span class="dv">4</span>],<span class="at">tolerance=</span><span class="dv">10</span><span class="sc">^-</span><span class="dv">4</span>)</span>
<span id="cb49-70"><a href="#cb49-70" aria-hidden="true" tabindex="-1"></a>lmerglmmTMB_sd<span class="ot">&lt;-</span><span class="fu">all.equal</span>(social31[<span class="dv">1</span>,<span class="dv">5</span>],social31[<span class="dv">3</span>,<span class="dv">5</span>],<span class="at">tolerance=</span><span class="fl">0.01</span>)</span>
<span id="cb49-71"><a href="#cb49-71" aria-hidden="true" tabindex="-1"></a>lmerglmmTMB_df<span class="ot">&lt;-</span><span class="fu">all.equal</span>(social31[<span class="dv">1</span>,<span class="dv">6</span>],social31[<span class="dv">3</span>,<span class="dv">6</span>])</span>
<span id="cb49-72"><a href="#cb49-72" aria-hidden="true" tabindex="-1"></a>lmerglmmTMB_p<span class="ot">&lt;-</span><span class="fu">all.equal</span>(social31[<span class="dv">1</span>,<span class="dv">7</span>],social31[<span class="dv">3</span>,<span class="dv">7</span>],<span class="at">tolerance=</span><span class="dv">10</span><span class="sc">^-</span><span class="dv">4</span>)</span>
<span id="cb49-73"><a href="#cb49-73" aria-hidden="true" tabindex="-1"></a>lmeglmmTMB_est<span class="ot">&lt;-</span><span class="fu">all.equal</span>(social31[<span class="dv">2</span>,<span class="dv">4</span>],social31[<span class="dv">3</span>,<span class="dv">4</span>],<span class="at">tolerance=</span><span class="dv">10</span><span class="sc">^-</span><span class="dv">4</span>)</span>
<span id="cb49-74"><a href="#cb49-74" aria-hidden="true" tabindex="-1"></a>lmeglmmTMB_sd<span class="ot">&lt;-</span><span class="fu">all.equal</span>(social31[<span class="dv">2</span>,<span class="dv">5</span>],social31[<span class="dv">3</span>,<span class="dv">5</span>],<span class="at">tolerance=</span><span class="fl">0.01</span>)</span>
<span id="cb49-75"><a href="#cb49-75" aria-hidden="true" tabindex="-1"></a>lmeglmmTMB_df<span class="ot">&lt;-</span><span class="fu">all.equal</span>(social31[<span class="dv">2</span>,<span class="dv">6</span>],social31[<span class="dv">3</span>,<span class="dv">6</span>])</span>
<span id="cb49-76"><a href="#cb49-76" aria-hidden="true" tabindex="-1"></a>lmeglmmTMB_pvalue<span class="ot">&lt;-</span><span class="fu">all.equal</span>(social31[<span class="dv">2</span>,<span class="dv">7</span>],social31[<span class="dv">3</span>,<span class="dv">7</span>],<span class="at">tolerance=</span><span class="dv">10</span><span class="sc">^-</span><span class="dv">4</span>)</span>
<span id="cb49-77"><a href="#cb49-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-78"><a href="#cb49-78" aria-hidden="true" tabindex="-1"></a><span class="co"># compare the  verbal_scale term</span></span>
<span id="cb49-79"><a href="#cb49-79" aria-hidden="true" tabindex="-1"></a>verbal_scale<span class="ot">&lt;-</span>coefficients_dataframe<span class="sc">|&gt;</span>dplyr<span class="sc">::</span><span class="fu">filter</span>(term<span class="sc">==</span><span class="st">"verbal_scale"</span>)<span class="sc">|&gt;</span>dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="st">"model"</span>,<span class="st">"effect"</span>,<span class="st">"term"</span>,<span class="st">"estimate"</span>,<span class="st">"std.error"</span>, <span class="st">"df"</span>,<span class="st">"p.value"</span>)</span>
<span id="cb49-80"><a href="#cb49-80" aria-hidden="true" tabindex="-1"></a>lmerlme_est<span class="ot">&lt;-</span><span class="fu">all.equal</span>(verbal_scale[<span class="dv">1</span>,<span class="dv">4</span>],verbal_scale[<span class="dv">2</span>,<span class="dv">4</span>],<span class="at">tolerance=</span><span class="dv">10</span><span class="sc">^-</span><span class="dv">4</span>)</span>
<span id="cb49-81"><a href="#cb49-81" aria-hidden="true" tabindex="-1"></a>lmerlme_sd<span class="ot">&lt;-</span><span class="fu">all.equal</span>(verbal_scale[<span class="dv">1</span>,<span class="dv">5</span>],verbal_scale[<span class="dv">2</span>,<span class="dv">5</span>],<span class="at">tolerance=</span><span class="dv">10</span><span class="sc">^-</span><span class="dv">4</span>)</span>
<span id="cb49-82"><a href="#cb49-82" aria-hidden="true" tabindex="-1"></a>lmerlme_df<span class="ot">&lt;-</span><span class="fu">all.equal</span>(verbal_scale[<span class="dv">1</span>,<span class="dv">6</span>],verbal_scale[<span class="dv">2</span>,<span class="dv">6</span>],<span class="at">tolerance=</span><span class="fl">0.1</span>)</span>
<span id="cb49-83"><a href="#cb49-83" aria-hidden="true" tabindex="-1"></a>lmerlme_pvalue<span class="ot">&lt;-</span><span class="fu">all.equal</span>(verbal_scale[<span class="dv">1</span>,<span class="dv">7</span>],verbal_scale[<span class="dv">2</span>,<span class="dv">7</span>],<span class="at">tolerance=</span><span class="dv">10</span><span class="sc">^-</span><span class="dv">4</span>)</span>
<span id="cb49-84"><a href="#cb49-84" aria-hidden="true" tabindex="-1"></a>lmerglmmTMB_est<span class="ot">&lt;-</span><span class="fu">all.equal</span>(verbal_scale[<span class="dv">1</span>,<span class="dv">4</span>],verbal_scale[<span class="dv">3</span>,<span class="dv">4</span>],<span class="at">tolerance=</span><span class="dv">10</span><span class="sc">^-</span><span class="dv">4</span>)</span>
<span id="cb49-85"><a href="#cb49-85" aria-hidden="true" tabindex="-1"></a>lmerglmmTMB_sd<span class="ot">&lt;-</span><span class="fu">all.equal</span>(verbal_scale[<span class="dv">1</span>,<span class="dv">5</span>],verbal_scale[<span class="dv">3</span>,<span class="dv">5</span>],<span class="at">tolerance=</span><span class="fl">0.01</span>)</span>
<span id="cb49-86"><a href="#cb49-86" aria-hidden="true" tabindex="-1"></a>lmerglmmTMB_df<span class="ot">&lt;-</span><span class="fu">all.equal</span>(verbal_scale[<span class="dv">1</span>,<span class="dv">6</span>],verbal_scale[<span class="dv">3</span>,<span class="dv">6</span>])</span>
<span id="cb49-87"><a href="#cb49-87" aria-hidden="true" tabindex="-1"></a>lmerglmmTMB_p<span class="ot">&lt;-</span><span class="fu">all.equal</span>(verbal_scale[<span class="dv">1</span>,<span class="dv">7</span>],verbal_scale[<span class="dv">3</span>,<span class="dv">7</span>],<span class="at">tolerance=</span><span class="dv">10</span><span class="sc">^-</span><span class="dv">4</span>)</span>
<span id="cb49-88"><a href="#cb49-88" aria-hidden="true" tabindex="-1"></a>lmeglmmTMB_est<span class="ot">&lt;-</span><span class="fu">all.equal</span>(verbal_scale[<span class="dv">2</span>,<span class="dv">4</span>],verbal_scale[<span class="dv">3</span>,<span class="dv">4</span>],<span class="at">tolerance=</span><span class="dv">10</span><span class="sc">^-</span><span class="dv">4</span>)</span>
<span id="cb49-89"><a href="#cb49-89" aria-hidden="true" tabindex="-1"></a>lmeglmmTMB_sd<span class="ot">&lt;-</span><span class="fu">all.equal</span>(verbal_scale[<span class="dv">2</span>,<span class="dv">5</span>],verbal_scale[<span class="dv">3</span>,<span class="dv">5</span>],<span class="at">tolerance=</span><span class="fl">0.01</span>)</span>
<span id="cb49-90"><a href="#cb49-90" aria-hidden="true" tabindex="-1"></a>lmeglmmTMB_df<span class="ot">&lt;-</span><span class="fu">all.equal</span>(verbal_scale[<span class="dv">2</span>,<span class="dv">6</span>],verbal_scale[<span class="dv">3</span>,<span class="dv">6</span>])</span>
<span id="cb49-91"><a href="#cb49-91" aria-hidden="true" tabindex="-1"></a>lmeglmmTMB_pvalue<span class="ot">&lt;-</span><span class="fu">all.equal</span>(verbal_scale[<span class="dv">2</span>,<span class="dv">7</span>],verbal_scale[<span class="dv">3</span>,<span class="dv">7</span>],<span class="at">tolerance=</span><span class="dv">10</span><span class="sc">^-</span><span class="dv">4</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>1).Intercept * lmer &amp; lme- estimation:equivalent; standard errors:equivalent; df:different; p value:equivalent * lmer &amp; glmmTMB- estimation:equivalent; standard errors:very similar; df:NA; p value:equivalent * lme &amp; glmmTMB- estimation:equivalent; standard errors:very similar; df:NA; p value:equivalent</p>
<p>2).sexF * lmer &amp; lme- estimation:equivalent; standard errors:equivalent; df:different; p value:slightly different * lmer &amp; glmmTMB- estimation:equivalent; standard errors:equivalent; df:NA; p value:slightly different * lme &amp; glmmTMB- estimation:equivalent; standard errors:very similar; df:NA; p value:slightly different</p>
<p>3).social1 * lmer &amp; lme- estimation:equivalent; standard errors:equivalent; df:different; p value:equivalent * lmer &amp; glmmTMB- estimation:equivalent; standard errors:sightly different; df:NA; p value:equivalent * lme &amp; glmmTMB- estimation:equivalent; standard errors:sightly different; df:NA; p value:equivalent</p>
<p>4).social20 * lmer &amp; lme- estimation:equivalent; standard errors:equivalent; df:slightly different; p value:equivalent * lmer &amp; glmmTMB- estimation:equivalent; standard errors:sightly different; df:NA; p value:equivalent * lme &amp; glmmTMB- estimation:equivalent; standard errors:sightly different; df:NA; p value:equivalent</p>
<p>5).social31 * lmer &amp; lme- estimation:equivalent; standard errors:equivalent; df:slightly different; p value:equivalent * lmer &amp; glmmTMB- estimation:equivalent; standard errors:very similar; df:NA; p value:equivalent * lme &amp; glmmTMB- estimation:equivalent; standard errors:very similar; df:NA; p value:equivalent</p>
<p>6).verbal_scale * lmer &amp; lme- estimation:equivalent; standard errors:equivalent; df:slightly different; p value:equivalent * lmer &amp; glmmTMB- estimation:equivalent; standard errors:very similar; df:NA; p value:equivalent * lme &amp; glmmTMB- estimation:equivalent; standard errors:very similar; df:NA; p value:equivalent</p>
</section>
<section id="g." class="level2">
<h2 class="anchored" data-anchor-id="g.">g.</h2>
<p>compare the coefficient plot with the different models</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="co"># method 1, by the ggplot with the data frame</span></span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>coefficients_dataframe<span class="sc">$</span>model<span class="ot">&lt;-</span><span class="fu">as.factor</span>(coefficients_dataframe<span class="sc">$</span>model)</span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a>coefficients_dataframe<span class="sc">$</span>term<span class="ot">&lt;-</span><span class="fu">as.factor</span>(coefficients_dataframe<span class="sc">$</span>term)</span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a>coefficients_dataframe<span class="sc">|&gt;</span>dplyr<span class="sc">::</span><span class="fu">filter</span>(term <span class="sc">!=</span> <span class="st">"(Intercept)"</span>)<span class="sc">|&gt;</span> ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">y=</span>term,<span class="at">x=</span>estimate,<span class="at">colour=</span>model ))<span class="sc">+</span><span class="fu">geom_point</span>()<span class="sc">+</span><span class="fu">facet_wrap</span>(<span class="sc">~</span>term,<span class="at">scales =</span> <span class="st">"free"</span>)<span class="sc">+</span><span class="fu">labs</span>(<span class="at">x=</span><span class="st">"Estimate"</span>,<span class="at">title =</span> <span class="st">"coefficient plot of the model fitted with the three different pakages"</span>)<span class="sc">+</span><span class="fu">theme_bw</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Assignment3_STAT720_files/figure-html/unnamed-chunk-10-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="co"># method 2, by the dotwhiskerpackage</span></span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>dotwhisker<span class="sc">::</span><span class="fu">dwplot</span>(models,<span class="at">effects=</span><span class="st">"fixed"</span>)<span class="sc">+</span><span class="fu">facet_wrap</span>(<span class="sc">~</span> term,<span class="at">scales =</span> <span class="st">"free"</span>)<span class="sc">+</span><span class="fu">theme_bw</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Assignment3_STAT720_files/figure-html/unnamed-chunk-10-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="h." class="level2">
<h2 class="anchored" data-anchor-id="h.">h.</h2>
<p>compare the two approaches that are to compute the denominator df</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>dflmer_1<span class="ot">&lt;-</span><span class="fu">coef</span>(<span class="fu">summary</span>(model_3,<span class="at">ddf=</span><span class="st">"Satterthwaite"</span>))[,<span class="st">"df"</span>]</span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>dflmer_2<span class="ot">&lt;-</span><span class="fu">coef</span>(<span class="fu">summary</span>(model_3,<span class="at">ddf =</span> <span class="st">"Kenward-Roger"</span>))[,<span class="st">"df"</span>]</span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a>dflme<span class="ot">&lt;-</span><span class="fu">coef</span>(<span class="fu">summary</span>(model_nlm))[,<span class="st">"DF"</span>]</span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a>compare_df<span class="ot">&lt;-</span><span class="fu">data.frame</span>(<span class="at">lmer_sa=</span>dflmer_1,<span class="at">lmer_ken=</span>dflmer_2,<span class="at">lme=</span>dflme)</span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-6"><a href="#cb52-6" aria-hidden="true" tabindex="-1"></a>compare_df</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>               lmer_sa  lmer_ken  lme
(Intercept)   155.5286  154.8764 3282
verbal_scale 3390.0592 3394.5626 3282
sexF          100.2033  111.6036 3282
social1      3365.7651 3373.6117 3282
social20     3367.5014 3374.0254 3282
social31     3405.3106 3408.5651 3282</code></pre>
</div>
</div>
<p>The two approaches will calculate different results for the degrees of freedom (df) within the same model. Although there are slight differences between them, the model created using the lme function remains unchanged regardless of the approach used. In contrast, the lmer function tends to produce more varied results. Overall, using lmer() is preferable for obtaining more accurate calculations of the degrees of freedom compared to lme().</p>
</section>
<section id="i." class="level2">
<h2 class="anchored" data-anchor-id="i.">i.</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>random_effect_group<span class="ot">&lt;-</span>lme4<span class="sc">::</span><span class="fu">ranef</span>(model_3)<span class="sc">$</span>primary</span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>fixed_sexslope<span class="ot">&lt;-</span>glmmTMB<span class="sc">::</span><span class="fu">fixef</span>(model_3)[<span class="st">"sexF"</span>]</span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a>random_effect_group<span class="sc">$</span>sex_deviation<span class="ot">&lt;-</span>random_effect_group<span class="sc">$</span>sexF<span class="sc">-</span>fixed_sexslope</span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(random_effect_group)[<span class="dv">1</span>]<span class="ot">=</span><span class="st">"Intercept"</span></span>
<span id="cb54-5"><a href="#cb54-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-6"><a href="#cb54-6" aria-hidden="true" tabindex="-1"></a>random_effect_group<span class="sc">|&gt;</span>ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>Intercept,<span class="at">y=</span>sex_deviation))<span class="sc">+</span><span class="fu">geom_point</span>()<span class="sc">+</span><span class="fu">labs</span>(<span class="at">x=</span><span class="st">"random effect on intercept"</span>,<span class="at">y=</span><span class="st">"random effect on slope of sex"</span>,<span class="at">title =</span> <span class="st">"random effect by primary froup"</span>)<span class="sc">+</span><span class="fu">theme_bw</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Assignment3_STAT720_files/figure-html/unnamed-chunk-12-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>It’s really interesting that it has the negative relationship between the random effect on intercept and on sex slope.(collinearity with the two random effect, should discard one)</p>
</section>
<section id="j." class="level2">
<h2 class="anchored" data-anchor-id="j.">j.</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Method 1</span></span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a>data<span class="sc">|&gt;</span> ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>verbal,<span class="at">y=</span>attain,<span class="at">colour =</span> sex))<span class="sc">+</span><span class="fu">geom_point</span>()<span class="sc">+</span><span class="fu">facet_wrap</span>(<span class="sc">~</span>social)<span class="sc">+</span><span class="fu">labs</span>(<span class="at">x=</span><span class="st">"verbal"</span>,<span class="at">y=</span><span class="st">"attain"</span>, <span class="at">title=</span><span class="st">"The relation of attain with verbal groupped by social"</span>)<span class="sc">+</span><span class="fu">theme_bw</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Assignment3_STAT720_files/figure-html/unnamed-chunk-13-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Method 2</span></span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>M_j<span class="ot">&lt;-</span>lmerTest<span class="sc">::</span><span class="fu">lmer</span>(attain<span class="sc">~</span> verbal_scale<span class="sc">+</span>sex<span class="sc">+</span>(verbal_scale<span class="sc">+</span>sex<span class="sc">|</span>social),data,<span class="at">REML =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>boundary (singular) fit: see help('isSingular')</code></pre>
</div>
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="co">#lme4::isSingular(M_j); lme4::rePCA(M_j), then discard the "sex" from the random effect</span></span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a>M_j2<span class="ot">&lt;-</span>lmerTest<span class="sc">::</span><span class="fu">lmer</span>(attain<span class="sc">~</span> verbal_scale<span class="sc">+</span>sex<span class="sc">+</span>(verbal_scale<span class="sc">|</span>social),data,<span class="at">REML =</span> <span class="cn">TRUE</span>)</span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a>performance<span class="sc">::</span><span class="fu">check_model</span>(M_j2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Some of the variables were in matrix-format - probably you used
  `scale()` on your data?
  If so, and you get an error, please try `datawizard::standardize()` to
  standardize your data.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Some of the variables were in matrix-format - probably you used
  `scale()` on your data?
  If so, and you get an error, please try `datawizard::standardize()` to
  standardize your data.</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Assignment3_STAT720_files/figure-html/unnamed-chunk-13-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="co"># The VIF of the two fixed predictors are beyond 10. So we need consider drop the one, with collinearity.</span></span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a>M_j2<span class="ot">&lt;-</span>lmerTest<span class="sc">::</span><span class="fu">lmer</span>(attain<span class="sc">~</span> verbal_scale<span class="sc">+</span>sex<span class="sc">+</span>(verbal_scale<span class="sc">|</span>social),data,<span class="at">REML =</span> <span class="cn">TRUE</span>)</span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a>performance<span class="sc">::</span><span class="fu">check_model</span>(M_j2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Some of the variables were in matrix-format - probably you used
  `scale()` on your data?
  If so, and you get an error, please try `datawizard::standardize()` to
  standardize your data.
Some of the variables were in matrix-format - probably you used
  `scale()` on your data?
  If so, and you get an error, please try `datawizard::standardize()` to
  standardize your data.</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Assignment3_STAT720_files/figure-html/unnamed-chunk-13-3.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a>M_j3<span class="ot">&lt;-</span>lmerTest<span class="sc">::</span><span class="fu">lmer</span>(attain<span class="sc">~</span> verbal_scale<span class="sc">+</span>(verbal_scale<span class="sc">|</span>social),data,<span class="at">REML =</span> <span class="cn">TRUE</span>)</span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a>performance<span class="sc">::</span><span class="fu">check_model</span>(M_j3)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Some of the variables were in matrix-format - probably you used
  `scale()` on your data?
  If so, and you get an error, please try `datawizard::standardize()` to
  standardize your data.
Some of the variables were in matrix-format - probably you used
  `scale()` on your data?
  If so, and you get an error, please try `datawizard::standardize()` to
  standardize your data.</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Assignment3_STAT720_files/figure-html/unnamed-chunk-13-4.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a>ransom<span class="ot">&lt;-</span>lme4<span class="sc">::</span><span class="fu">ranef</span>(M_j3)<span class="sc">$</span>social</span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a>fixed<span class="ot">&lt;-</span>glmmTMB<span class="sc">::</span><span class="fu">fixef</span>(M_j3)[<span class="st">"verbal_scale"</span>]</span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a>ransom<span class="sc">$</span>deviation<span class="ot">&lt;-</span>ransom<span class="sc">$</span>verbal_scale<span class="sc">-</span>fixed</span>
<span id="cb65-4"><a href="#cb65-4" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(ransom)[<span class="dv">1</span>]<span class="ot">=</span><span class="st">"Intercept"</span></span>
<span id="cb65-5"><a href="#cb65-5" aria-hidden="true" tabindex="-1"></a>ransom<span class="sc">|&gt;</span> ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>Intercept,<span class="at">y=</span>deviation))<span class="sc">+</span><span class="fu">geom_point</span>()<span class="sc">+</span><span class="fu">labs</span>(<span class="at">x=</span><span class="st">"random effect on intercept"</span>,<span class="at">y=</span><span class="st">"random effect on slope of verbal"</span>,<span class="at">title =</span> <span class="st">"random effect by social group"</span>)<span class="sc">+</span><span class="fu">theme_bw</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Assignment3_STAT720_files/figure-html/unnamed-chunk-13-5.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>By combining the results from methods 1 and 2, we can see that the “social” factor is not clearly significant in identifying the model’s influence on the intercept and/or slope at different levels of “social.”</p>
</section>
<section id="k." class="level2">
<h2 class="anchored" data-anchor-id="k.">k.</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a>train_id<span class="ot">&lt;-</span><span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(data),<span class="fu">nrow</span>(data)<span class="sc">*</span><span class="fl">0.7</span>)</span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a>Train_data<span class="ot">&lt;-</span>data[train_id,]</span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a>Test_data<span class="ot">&lt;-</span>data[<span class="sc">-</span>train_id,]</span>
<span id="cb66-4"><a href="#cb66-4" aria-hidden="true" tabindex="-1"></a>M_knew<span class="ot">&lt;-</span>lmerTest<span class="sc">::</span><span class="fu">lmer</span>(attain<span class="sc">~</span>verbal_scale<span class="sc">+</span>sex<span class="sc">+</span>(sex<span class="sc">|</span>primary),Train_data,<span class="at">REML =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>boundary (singular) fit: see help('isSingular')</code></pre>
</div>
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a>M_k<span class="ot">&lt;-</span>lmerTest<span class="sc">::</span><span class="fu">lmer</span>(attain<span class="sc">~</span>verbal_scale<span class="sc">+</span>sex<span class="sc">+</span>social<span class="sc">+</span>(sex<span class="sc">|</span>primary),Train_data,<span class="at">REML=</span><span class="cn">TRUE</span>)</span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a>predictnew<span class="ot">&lt;-</span><span class="fu">predict</span>(M_knew,Test_data,<span class="at">allow.new.levels=</span><span class="cn">TRUE</span>)</span>
<span id="cb68-3"><a href="#cb68-3" aria-hidden="true" tabindex="-1"></a>predict<span class="ot">&lt;-</span><span class="fu">predict</span>(M_k,Test_data,<span class="at">allow.new.levels=</span><span class="cn">TRUE</span>)</span>
<span id="cb68-4"><a href="#cb68-4" aria-hidden="true" tabindex="-1"></a>Test_errornew<span class="ot">&lt;-</span><span class="fu">sqrt</span>(<span class="fu">sum</span>((Test_data<span class="sc">$</span>attain<span class="sc">-</span>predictnew)<span class="sc">^</span><span class="dv">2</span>))</span>
<span id="cb68-5"><a href="#cb68-5" aria-hidden="true" tabindex="-1"></a>Test_error<span class="ot">&lt;-</span><span class="fu">sqrt</span>(<span class="fu">sum</span>((Test_data<span class="sc">$</span>attain<span class="sc">-</span>predict)<span class="sc">^</span><span class="dv">2</span>))</span>
<span id="cb68-6"><a href="#cb68-6" aria-hidden="true" tabindex="-1"></a>Test_errornew<span class="sc">&gt;</span>Test_error</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] TRUE</code></pre>
</div>
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a><span class="fu">all.equal</span>(Test_errornew,Test_error,<span class="at">tolerance =</span> <span class="fl">0.1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] TRUE</code></pre>
</div>
</div>
<p>We split the data into two parts, using a 70/30 ratio, and then tested the error rates of two models. One model retains the fixed effect of social factors, while the other discards it. Upon comparing the test errors of the two models, we found that the model which keeps the social fixed effect has a smaller error compared to the other model.</p>
</section>
<section id="l." class="level2">
<h2 class="anchored" data-anchor-id="l.">l.</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a>M_l<span class="ot">&lt;-</span>lmerTest<span class="sc">::</span><span class="fu">lmer</span>(attain<span class="sc">~</span>verbal_scale<span class="sc">+</span>sex<span class="sc">+</span>social<span class="sc">+</span>(<span class="dv">1</span><span class="sc">|</span>primary),data,<span class="at">REML =</span> <span class="cn">TRUE</span>)</span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a>Aic_new<span class="ot">&lt;-</span><span class="fu">AIC</span>(M_l)</span>
<span id="cb72-3"><a href="#cb72-3" aria-hidden="true" tabindex="-1"></a>Aic_ori<span class="ot">&lt;-</span><span class="fu">AIC</span>(model_3)</span>
<span id="cb72-4"><a href="#cb72-4" aria-hidden="true" tabindex="-1"></a>Aic_new<span class="sc">&gt;</span>Aic_ori</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] TRUE</code></pre>
</div>
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Hypothesis test one-LRT</span></span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a>Test1<span class="ot">&lt;-</span><span class="fu">anova</span>(M_l,model_3)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>refitting model(s) with ML (instead of REML)</code></pre>
</div>
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a>Test1<span class="sc">$</span><span class="st">`</span><span class="at">Pr(&gt;Chisq)</span><span class="st">`</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1]         NA 0.00442487</code></pre>
</div>
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Hypothesis test two-test statistics</span></span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true" tabindex="-1"></a>pbkrtest<span class="sc">::</span><span class="fu">PBmodcomp</span>(M_l,model_3)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Bootstrap test; time: 399.22 sec; samples: 1000; extremes: 0;
Requested samples: 1000 Used samples: 0 Extremes: 0
large : attain ~ verbal_scale + sex + social + (1 | primary)
attain ~ verbal_scale + sex + social + (sex | primary)
          stat df p.value
LRT    -10.841 -2     NaN
PBtest -10.841          1</code></pre>
</div>
</div>
<p>The random effect of sex by the primary group variable is significantly different from 0, as indicated by the likelihood ratio test. Additionally, the AIC suggests that the original model, which includes the random effect of sex on the slope, is better than the reduced model.</p>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>